<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <meta charset="UTF-8">
  <title>ê²€ìƒ‰ ê²°ê³¼</title>
</head>
<body>
<main layout:fragment="content" class="search-result-container">

  <!-- contentName ì´ ë¹„ì—ˆì„ ë•Œ -->
  <h4 th:if="${#strings.isEmpty(contentName)}">ì „ì²´ ê²€ìƒ‰ê²°ê³¼ì…ë‹ˆë‹¤.</h4>

  <!-- contentName ì´ ìˆì„ ë•Œ -->
  <h4 th:unless="${#strings.isEmpty(contentName)}">
    "<span th:text="${contentName}"></span>" ê²€ìƒ‰ê²°ê³¼ì…ë‹ˆë‹¤.
  </h4>

  <!-- ì¹´í…Œê³ ë¦¬ ë©”ë‰´ -->
  <div class="menu">
    <button onclick="showCategory('movie')">ğŸ¬ ì˜í™”</button>
    <button onclick="showCategory('music')">ğŸ§ ìŒì•…</button>
    <button onclick="showCategory('book')">ğŸ“š ë„ì„œ</button>
  </div>

  <!-- ì˜í™” -->
  <div class="category" id="movie">
    <h3><span class="highlight">ì˜í™”</span> ê²€ìƒ‰ ê²°ê³¼</h3>
    <div th:if="${movie.size() > 0}" class="card-container">
      <div th:each="m : ${movie}" class="card-movie"
           th:attr="onclick=
             'showDetailModal(' +
               '\'' + ${#strings.escapeJavaScript(m.title)} + '\',' +
               '\'' + ${#strings.escapeJavaScript(m.releaseDate)} + '\',' +
               '\'' + ${#strings.escapeJavaScript(m.summary)} + '\',' +
               '\'' + ${m.thumbnail} + '\',' +
               '\'movie\'' +
             ')'">
        <img th:src="${m.thumbnail}" alt="ì˜í™” ì¸ë„¤ì¼" class="card-thumbnail"/>
      </div>
    </div>
    <div th:if="${movie.size() == 0}"><p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>
  </div>

  <!-- ìŒì•… -->
  <div class="category" id="music">
    <h3><span class="highlight">ìŒì•…</span> ê²€ìƒ‰ ê²°ê³¼</h3>
    <div th:if="${music.size() > 0}" class="card-container">
      <div th:each="m : ${music}" class="card-music"
           th:attr="onclick=
             'showDetailModal(' +
               '\'' + ${#strings.escapeJavaScript(m.title)} + '\',' +
               '\'' + ${#strings.escapeJavaScript(m.releaseDate)} + '\',' +
               '\'' + ${#strings.escapeJavaScript(m.lyrics)} + '\',' +
               '\'' + ${m.thumbnail} + '\',' +
               '\'music\'' +
             ')'">
        <img th:src="${m.thumbnail}" alt="ìŒì•… ì¸ë„¤ì¼" class="card-thumbnail music-thumb"/>
      </div>
    </div>
    <div th:if="${music.size() == 0}"><p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>
  </div>

  <!-- ë„ì„œ -->
  <div class="category" id="book">
    <h3><span class="highlight">ë„ì„œ</span> ê²€ìƒ‰ ê²°ê³¼</h3>
    <div th:if="${book.size() > 0}" class="card-container">
      <div th:each="b : ${book}" class="card-book"
           th:attr="onclick=
             'showDetailModal(' +
               '\'' + ${#strings.escapeJavaScript(b.title)} + '\',' +
               '\'' + ${#strings.escapeJavaScript(b.publishedDate)} + '\',' +
               '\'' + ${#strings.escapeJavaScript(b.description)} + '\',' +
               '\'' + ${b.image} + '\',' +
               '\'book\'' +
             ')'">
        <img th:src="${b.image}" alt="ë„ì„œ ì¸ë„¤ì¼" class="card-thumbnail modal-bg.book"/>
      </div>
    </div>
    <div th:if="${book.size() == 0}"><p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>
  </div>

  <!-- ëª¨ë‹¬ -->
  <div id="detailModal" onclick="if(event.target===this) closeModal()">
    <div class="search-modal-content">
      <img id="modalBg" class="modal-bg" src="" alt="ë°°ê²½"/>
      <div class="modal-info">
        <span class="modal-close" onclick="closeModal()">Ã—</span>
        <h1 id="modalTitle" class="modal-title"></h1>
        <ul class="modal-badges">
          <li id="modalYear"></li>
<!--          <li id="singer"></li>-->
<!--          <li id="author"></li>-->
<!--          ì—°ë ¹, ì¥ë¥´ ë“± ì •ë³´ 3ì°¨ í”Œì  ë•Œ ì¶”ê°€ ì˜ˆì •-->
<!--          <li>12+</li>-->
<!--          <li id="modalSeries">ì½˜í…ì¸ </li>-->
<!--          <li id="modalGenre">ì¥ë¥´</li>-->
        </ul>
        <p id="modalSummary" class="modal-summary"></p>
        <button id="modalSearchBtn" class="modal-play" disabled>ê²€ìƒ‰í•˜ê¸° âœ</button>
      </div>
    </div>
  </div>

</main>
</body>
</html>

<script>
  /* ì¹´í…Œê³ ë¦¬ í† ê¸€ */
  function showCategory(id){
    document.querySelectorAll('.category').forEach(c=>c.style.display='none');
    document.getElementById(id).style.display='block';
  }
  document.addEventListener('DOMContentLoaded',()=>showCategory('movie'));

  function showDetailModal(title, releaseDate, summary, thumbnail, type){
    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalYear').textContent  = releaseDate.split('-')[0] || releaseDate;
    document.getElementById('modalSummary').textContent = summary;

    const img = document.getElementById('modalBg');
    img.src = thumbnail;

    img.classList.remove('music');
    if(type === 'music'){ img.classList.add('music'); }

    img.classList.remove('book');
    if(type === 'book'){ img.classList.add('book'); }

    // ëª¨ë‹¬ ì—´ê¸°
    document.getElementById('detailModal').classList.add('active');

    // ê²€ìƒ‰ ë²„íŠ¼ í™œì„±í™” ë° í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
    const searchBtn = document.getElementById('modalSearchBtn');
    searchBtn.disabled = false;

    // í´ë¦­ ì‹œ êµ¬ê¸€ ê²€ìƒ‰ ì—´ê¸°
    searchBtn.onclick = function() {
      const query = encodeURIComponent(title);
      const url = `https://www.google.com/search?q=${query}`;
      window.open(url, '_blank');
    }
  }

  /* ëª¨ë‹¬ ë‹«ê¸° */
  function closeModal(){
    document.getElementById('detailModal').classList.remove('active');
    const searchBtn = document.getElementById('modalSearchBtn');
    searchBtn.disabled = true;
    searchBtn.onclick = null; // ì´ë²¤íŠ¸ ë¦¬ì…‹
  }
</script>
